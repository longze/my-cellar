# Vue-cli 源码解读

> Vue-cli 是创建 Vue 项目的脚手架，但是不像 Angular 和 React 脚手架那样提供大而全的功能，而是让使用者通过学习其他开源工具(如 Express，webpack 等)来根据自己的项目定制脚手架。两种思路各有优劣，这里不做评判，关于这一点可以在知乎看 大漠穷秋 和 尤雨溪 的论战。由于 Vue-cli 脚手架的特点，我们需要深入了解 Vue-cli 的源码，才能更好的配置自己的脚手架，搜易这篇文章来了。

## 用到了那些库？

如果你对前端的开源项目保持关注，那么通过阅读 package.json 中的依赖你就能大体猜到这个脚手架有什么功能，采用那个方案实现的。Vue-cli 一共用到 53 个库，我们挑几个说一下。

- babel 系列，那意味着可以写 ES6 了；
- commander，看来能在命令行敲几行命令玩玩；
- express，有服务端的能力，不是个简单打包工具；
- postcss-loader，写样式不用加浏览器前缀了；
- vue 系列，哦 ~ 这是个 Vue 脚手架；
- webpack，可以随便玩包了；
- webpack-hot-middleware，看来不用手动刷页面了；
- eslint，编码规范检测也有了；
- mocha，单元测试也有了。

一眼瞥过去能看懂这些，还有什么能一眼看出来的欢迎补充。

## 目录

了解项目下的各个文件夹是干什么的，是一种读源码不错的开始：

    ${object-root}
        ├── bin  命令执行的入口文件，对应 package.json 的 bin 配置
        ├── docs 文档
        ├── lib  功能代码，提供 bin 所需的一切
        └── test 测试相关
    
其实最重要的就是 bin 和 lib 这两个文件夹了，之所以没有将代码全部写进 bin 我觉得有以下几点考虑(其实很多项目都是这么做的)：

一、bin 中的每个文件会比较大；

二、bin 中的内容提供一个二级目录的功能，具体实现交给 lib 中的模块，你可以从 bin 中找到你关心的内容然后进入到 lib 中查看细节，而不用把全部代码都看一遍。

三、一些公用的配置和功能模块可以抽离出来，A 和 B 公用的部分放在 A 和 B 任何一方都是不合理的。

## 整理流程和关键点

读一个库要把它能干什么时刻放在心里，这样不会“因为走的太久，而忘记为什么出发”。

- vue-init，初始化项目命令；
- vue-list，列出可选模板；
- vue-build，构建项目；
- vue，通过参数调用上面 3 个。

先从最简单的 vue-list 说起，调用 github api 提供的接口，然后拼字符串打印出来。显然这货在断网环境下是玩不转的。这里我们可以 get 两个新技能：

- https://api.github.com 原来世界上还存在这么个东东，我是如此的孤陋寡闻；
- 库 chalk，有了这个宝贝妈妈再也不用担心我的命名行输出不能高亮了。

官方提供了 6 套模板，帮助我们初始化不同类型(从技术栈的角度划分)的项目。
