# 《鸟哥的 Linux 私房菜》读书笔记

> 为了不底层基础大的更牢靠，阅读以下系统相关的书是必要的，由于这本书没有电子版发行，这篇是阅读纸质版的笔记，方便查阅和自我梳理。

## Linux 的规则和安装

历史回顾 -- 程序员是个年轻的职业：

- 1985 年 Windows 1.0 发布；
- 1996 年 Linux 1.0 正式上线。

之前的计算机基本是实验室里东西，实际使用单位也只有不差钱的政府和研究性质的高校。

Linux 能干啥 -- 企业应用，网路服务，企业网络管理。

如何学习 Linux -- 如果只想“会使用”Linux，那么 X Window 也足够了；如果想深入学习 Linux，那么命令行才是学习的不二方式。

Linux 的安装可以在 Virtuabox 中练习，练习一些系统初始化的设置，现在一般是云服务器，提交一个配置表单提供方就直接重装了，所以这里不展开。

Linux 下的两种桌面环境：GNOME[nəʊm], KDE(Kool Desktop Environment)。

然后是几个基础的命令，有的时候装某些软件有对系统的要求：

```shell
# 查看 Linux 内核版本，有时也叫 binaries
uname -a
# 结果：3.10.0_3-0-0-11 CST 2015 x86_64 x86_64 x86_64 GNU/Linux

# 查看 centos 版本
cat /etc/issue
# 结果：CentOS release 6.3
```

然后就是用 `man` 来获取命令的帮助，比如：

```shell
man cat
```
最后记住忘了 root 密码不用重装系统也能搞定，但愿你永远用不到。什么？你担心不安全？哦，可以通过加堡垒机之类的方案做增强。

## 文件与目录

### 那些重要的文件 与 FHS

`/etc/` 下存放系统的重要配置，其中 `/etc/shadow` 存放所有的用户名和密码，当然只有 root 权限才能看，密码当让也是加过密的。

`/etc/group` 中存放的是用户组信息。

`/etc/profile` 中存放全局的环境变量。可以在文件的 `Path manipulation` 部分修改。

除了上面这些系统定义好的文件与文件夹之外，Linux 对软件和用户也提出了规范 -- FHS(Filesystem Hierarchy Standard)。

比如 `/home/` 下，放用户目录，在新建用户的时候 CentOS 6.3 会自动在 `/home/` 下创建同名目录(CentOS 4.3需要手动创建)。

比如 `/usr/local`，建议管理员将软件安装到这里，Redis 和 MondoDB 都是这么建议的。

### 文件权限

说到文件权限，就不得不提用户和用户组的相关内容，但是这里我们花开两朵各表一枝，先说文件权限，假设所有用户和用户组以及两者之间的关系已经确定不变。

Linux 作为多用户操作系统文件权限是其保证安全的根本。怎么查看一个文件或文件夹的权限呢？

```shell
ls -al
ll -a
# 比如 /home/ 下我自己的目录是下面这样
drwx------ 11 longze    longze  4096     Dec 22 20:17 longze
[权限]   [连接] [所有者]  [用户组] [文件容量] [修改日期]    [文件名]
```

两条命令等价，第一个字母代表文件类型：

- `d` 代表文件夹;
- `-` 代表文件;
- `l` 代表引用。

之后的 9 个字母分成三组，每三个字母一组，分别对应“文件主”、“组用户”、“其他用户”:

- `r` 代表只读；
- `w` 代表写；
- `x` 代表可执行；
- `-` 代表空许可。

用 `chmod` 可变更权限，如 `chmod o+w,g+w longze`：

- `u` 表示“用户（user）”，即文件或目录的所有者。
- `g` 表示“同组（group）用户”，即与文件属主有相同组ID的所有用户。
- `o` 表示“其他（others）用户”。
- `a` 表示“所有（all）用户”。它是系统默认值。

改变文件的所有者和用户组，加 `-R` 参数可修改子目录下的全部文件权限：

```shell
# 改变 owner
chown -R 用户名 文件(夹)名
# 改变 group
chgrp -R 用户组名 文件(夹)名
```

### 文件与目录管理

先来一组基础命令

```shell
# 查看当前路径
pwd
# 新建文件夹
mkdir -p a/b/c
# 删除文件夹及其内部的全部内容
rm -rf 文件夹名称
# 复制，复制文件夹以及里面的内容加参数 -r，联通文件属性复制加 -p
cp -rp 源文件 目标文件
# 移动文件，文件更名
mv 源文件 目标文件
# 从远程下载文件
wget
# 新建文件，
touch text
# 读文件
cat text
# 在当前目录以及其子目录下有没有一个 text 文件
find ./ -name text
```

有些命令我们在任何地方都可以执行，这归功于环境变量，可以用 `echo` 将此变量打印出来查看：

```shell
echo $PATH
# 结果：/usr/local/bin:/usr/bin:/bin
```

当我们执行一个命令的时候，Linux 会从上面的那些文件夹中(以冒号间隔)查找有没有我们输入的命令对应的可执行文件，如果找到了就执行。想要对所有户都生效修改 `/etc/profile` 文件，想要对当前用户生效修改 `~/.bash_profile` 文件，修改的方式都是在行尾加上一行：

```shell
# 添加某某环境变量
export PATH=$PATH:自定义路径
```

如果想知道命令 `ls` 具体在哪里可以用 `which ls` 命令。

还有一个文件默认权限的设置 umask，查看默认权限有下面两种形式：

```shell
umas
# 结果：0002
umas -S
# 结果：u=rwx,g=rwx,o=rx
```

0002 的第一位是特殊权限先不管他，后面的 002 对应 u=rwx,g=rwx,o=rx。rwx 对应 421，然后用默认全有的 7 减去有的权限就是看到的数字。所以有一个大招叫 `chmod 777`。重新设置也很简单：

```shell
umask 000
umask -S
# 结果：u=rwx,g=rwx,o=rwx
```

`inode` 记录索引和权限，`block` 存储具体的内容。还有一些分区和挂载相关的内容都已经工具化了，这里的原理简单了解就好，不详诉。

最后补一个打包压缩和解压的命令：

```shell
# 压缩
tar -jcv -f a.tar.bz2    a
            压缩后的名称   被压缩的文件夹
# 解压到当前文件夹
tar -jxv -f a.tar.bz2 -C ./
# 不解压也可以看目录
tar -jtv -f a.tar.bz2
```

## Shell

### vim

首先要明确的就是三种模式：

- 一般模式，默认进入就是这种模式；
- 编辑模式，输入 “i、e” 等进入此模式，“ESC” 退出此模式；
- 命令行模式，输入 “:” 等进入此模式，“:wq” 保存并离开。

在一般模式下可以快速移动通过翻页等操作快速移动光标，然后进入编辑模式光标位置是不变的，下面列一些常用的操作：

- `ctr + f` 向下翻页；
- `ctr + b` 向上翻页；
- `数字 + space` 光标向后移动“数字”个位置；
- `0` 移到行首；
- `$` 移到行尾；
- `G` 移到文件的最后一行，主意已定要大写；
- `nG` 移到文件的第 n 行；
- `gg` 移到文件的第一行。

一般模式下也可以快速编辑，下面也是一些常用的命令：

- `dd` 删除所在行；
- `ndd` n 为数字，删除光标所在的向下 n 行；
- `yy` 复制光标所在的行；
- `p` 将复制的一行粘贴在当先行的下一行；
- `P` 将复制的一行粘贴在当先行的上一行；

若未修改可以 `:q` 直接离开，如果已经修改但是想放弃修改强制离开可以用 `:q!`。

### bash

硬件 <--> 服务器内核 <--> Shell <--> 用户，shell 和 bash 的关系：bash 是 shell 的一种实现。我们来看看当前机器有多少个 shell 工具：

```shell
cat /etc/shells
# 结果：
/bin/sh
/bin/bash
/sbin/nologin
/bin/zsh
/bin/tcsh
/bin/csh
# 不同用户可以配置不同的 shell 工具
cat /etc/passwd
work:x:502:502::/home/work:/bin/bash
```

为什么要学 shell：全(可视化工具是shell的子集)、快(远程操作命令行非常快)。

下面我们来认真学学 shell，我们都知道按向上键可以调出已经输入过的命令，那如果有个牛人上个月在我电脑上输了一些牛逼的命令我现在能调出来吗？当然可以，那怎么调，一条条翻到上个月？

```shell
cat ~/bash_history
```

所有的命令都在里面了，默认能存1000条，需要注意的一点是只有 bash 注销后才写文件。还有一个别名的功能，还记得 `ll` 等同于 `ls -l`，可以用 `alias` 查看更多简写：

```shell
alias
# 部分结果
ll='ls -lh'
gba='git branch -a'
md='mkdir -p'
# 还可以设置新的别名或修改已有别名
alias gp='git push'
# 删除别名
unalias gp
```

还有一个比较重要的概念那就是环境变量了，使用 env 或者 export 可以看到所有的环境变量：

```shell
env
# 部分结果
PATH=/usr/local/bin:/usr/bin
USER=zhaoxiaoqiang
# 查看一个环境变量
echo $USER
# 临时声明一个环境变量(通常大写字符为系统默认变量，用户变量建议用小写)
myName="xiao qiang"
echo $myName
# 若变量需要在其它子进程中使用，可以用 export 变成环境变量
# 注意是子进程，在其它命令行窗口依然调用不到的
# 如果想在任意命令窗口都可以使用，重启后依然可以使用，需要修改环境变量配置文件
export myName
# 销毁变量和环境变量都可以用 unset
unset myName
```

其实环境变量有很多个，PATH 是比较特别的一个，命令执行时如果当前目录没有此命令就从 PATH 环境变量的值所配置的文件路径一个个找过去。

